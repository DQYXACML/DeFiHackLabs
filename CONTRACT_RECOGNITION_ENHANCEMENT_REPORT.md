# åˆçº¦è¯†åˆ«ç‡æå‡æŠ¥å‘Š (V3)

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
æå‡çº¦æŸæå–ç³»ç»Ÿçš„åˆçº¦è¯†åˆ«ç‡,è§£å†³V2ç‰ˆæœ¬ä¸­9ä¸ªåè®®å› æ³¨é‡Šæ ¼å¼é—®é¢˜æ— æ³•è¯†åˆ«åˆçº¦çš„é—®é¢˜ã€‚

## âœ… å®æ–½æ–¹æ¡ˆ

### 1. å¤šæ¨¡å¼åŒ¹é…ç­–ç•¥

å®ç°äº†5ç§ä¸åŒçš„æ³¨é‡Šæ ¼å¼è¯†åˆ«æ¨¡å¼:

```python
patterns = [
    # æ¨¡å¼1: æ ‡å‡†æ ¼å¼ "Vulnerable Contract : https://...address/0x..."
    r'//\s*Vuln(?:erable)?\s+Contract\s*:\s*https?://[^/]+/address/(0x[a-fA-F0-9]{40})',

    # æ¨¡å¼2: Markdownæ ¼å¼ "- Vuln Contract: https://..."
    r'-\s*Vuln(?:erable)?\s+Contract\s*:\s*https?://[^/]+/address/(0x[a-fA-F0-9]{40})',

    # æ¨¡å¼3: æ— URLæ ¼å¼ "Vulnerable Contract : 0x..."
    r'//\s*Vuln(?:erable)?\s+Contract\s*:\s*(0x[a-fA-F0-9]{40})',

    # æ¨¡å¼4: å¤‡ç”¨å…³é”®è¯ "Victim Contract"
    r'//\s*Victim\s+Contract\s*:\s*https?://[^/]+/address/(0x[a-fA-F0-9]{40})',

    # æ¨¡å¼5: å®½æ¾åŒ¹é… "Vulnerable: https://..."
    r'//\s*Vuln(?:erable)?\s*:\s*https?://[^/]+/address/(0x[a-fA-F0-9]{40})',
]
```

**è¦†ç›–çš„æ¡ˆä¾‹**:
- âœ… æ ‡å‡†æ ¼å¼: `// Vulnerable Contract : https://etherscan.io/address/0x...`
- âœ… Markdownæ ¼å¼: `- Vuln Contract: https://etherscan.io/address/0x...` (Bmizapper)
- âœ… æ— URLæ ¼å¼: `// Vulnerable Contract : 0x...` (Gamma)
- âœ… Victimå…³é”®è¯: `// Victim Contract : https://...` (DAO_SoulMate)

### 2. å¢å¼ºçš„åˆçº¦åç§°æ¨æ–­

å®ç°äº†4ç§ç­–ç•¥è‡ªåŠ¨æ¨æ–­åˆçº¦åç§°:

```python
# ç­–ç•¥1: æ¥å£å®šä¹‰ (æœ€å¸¸è§)
# ContractName = IContractInterface(0x...)
wBARL = IwBARL(0x04c80bb477890f3021f03b068238836ee20aa0b8)

# ç­–ç•¥2: addresså¸¸é‡å®šä¹‰ (Gammaä½¿ç”¨)
# address constant uniproxy = 0x...
address constant uniproxy = 0x1F1Ca4e8236CD13032653391dB7e9544a6ad123E;

# ç­–ç•¥3: æ¥å£ç±»å‹å£°æ˜
# IVulnerableContract vuln = IVulnerableContract(0x...)

# ç­–ç•¥4: ä»å‡½æ•°è°ƒç”¨æ¨æ–­
# robot1.execute(...) -> Robot1
```

**å®é™…æ•ˆæœ**:
- âœ… Gamma_exp: ä»`address constant uniproxy`æ¨æ–­å‡º"Uniproxy"
- âœ… DAO_SoulMate_exp: ä»`// Victim Contract`è¯†åˆ«å‡º"SoulMateContract"
- âœ… Shell_MEV_0xa898_exp: æ¨æ–­å‡º"Robot1"
- âœ… XSIJ_exp: æ¨æ–­å‡º"PancakePair"

### 3. å¤‡ç”¨ç­–ç•¥:æ¥å£å®šä¹‰

å½“æ³¨é‡Šä¸­æ‰¾ä¸åˆ°åœ°å€æ—¶,ä»Solidityä»£ç ä¸­çš„æ¥å£å®šä¹‰æ¨æ–­:

```python
# æŸ¥æ‰¾ç±»ä¼¼ IVulnContract vuln = IVulnContract(0x...)
interface_pattern = r'I(\w+)\s+\w+\s*=\s*I\w+\((0x[a-fA-F0-9]{40})\)'
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æ•´ä½“æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | V2 | V3 | æ”¹è¿› |
|------|----|----|------|
| **åˆçº¦åœ°å€è¯†åˆ«æˆåŠŸ** | 10/19 (52.6%) | **19/19 (100%)** â­ | **+9 (+90%)** |
| **åˆçº¦åç§°è¯†åˆ«æˆåŠŸ** | 10/19 (52.6%) | **17/19 (89.5%)** | **+7 (+70%)** |
| **è¯†åˆ«åˆ°å‡½æ•°è°ƒç”¨** | 9/19 (47.4%) | **12/19 (63.2%)** | **+3 (+33%)** |
| **ç”Ÿæˆçº¦æŸçš„åè®®** | 6/19 (31.6%) | **7/19 (36.8%)** | +1 (+16.7%) |
| **æ€»çº¦æŸæ•°** | 26 | **27** | +1 (+3.8%) |

### å…³é”®æˆå°±

1. **åˆçº¦åœ°å€è¯†åˆ«ç‡100%** âœ¨
   - V2: 9ä¸ªåè®®åœ°å€ä¸ºNone
   - V3: æ‰€æœ‰19ä¸ªåè®®éƒ½è¯†åˆ«åˆ°äº†åœ°å€

2. **åˆçº¦åç§°è¯†åˆ«ç‡89.5%** ğŸ¯
   - V2: åªæœ‰10ä¸ªåè®®æœ‰å…·ä½“åç§°
   - V3: 17ä¸ªåè®®æœ‰å…·ä½“åç§°
   - æ”¹è¿›: +7ä¸ªåè®® (+70%)

3. **å‡½æ•°è°ƒç”¨è¯†åˆ«æå‡** ğŸ“ˆ
   - V2: 9ä¸ªåè®®è¯†åˆ«åˆ°å‡½æ•°è°ƒç”¨
   - V3: 12ä¸ªåè®®è¯†åˆ«åˆ°å‡½æ•°è°ƒç”¨
   - æ–°å¢: Bmizapper, Shell_MEV_0xa898, DAO_SoulMate

4. **æ–°ç”Ÿæˆçº¦æŸçš„åè®®** â­
   - DAO_SoulMate_exp: 1ä¸ªdrain_attackçº¦æŸ

### æ–°è¯†åˆ«çš„åˆçº¦è¯¦æƒ…

| åè®® | V2çŠ¶æ€ | V3è¯†åˆ«ç»“æœ | è¯†åˆ«æ¨¡å¼ |
|------|--------|-----------|---------|
| SocketGateway_exp | Unknown | _gateway | ç­–ç•¥1:æ¥å£å®šä¹‰ |
| WiseLending03_exp | Unknown | Vm | ç­–ç•¥1:æ¥å£å®šä¹‰ |
| Bmizapper_exp | None | bmiZapper | æ¨¡å¼2:Markdownæ ¼å¼ |
| Gamma_exp | None | Uniproxy | æ¨¡å¼3:æ— URL+ç­–ç•¥2:addresså¸¸é‡ |
| LQDX_alert_exp | None | ERC20 | ç­–ç•¥2:addresså¸¸é‡ |
| Shell_MEV_0xa898_exp | Unknown | Robot1 | ç­–ç•¥4:å‡½æ•°è°ƒç”¨æ¨æ–­ |
| XSIJ_exp | None | PancakePair | ç­–ç•¥1:æ¥å£å®šä¹‰ |
| DAO_SoulMate_exp | None | SoulMateContract | æ¨¡å¼4:Victimå…³é”®è¯ |

### è¯†åˆ«åˆ°ä½†æœªç”Ÿæˆçº¦æŸçš„åè®®åˆ†æ

ä»¥ä¸‹åè®®å·²æˆåŠŸè¯†åˆ«åˆçº¦,ä½†å› å…¶ä»–åŸå› æœªç”Ÿæˆçº¦æŸ:

1. **Bmizapper_exp** (bmiZapper)
   - è¯†åˆ«åˆ°1ä¸ªå‡½æ•°è°ƒç”¨
   - åŸå› : å‡½æ•°åæœªåŒ¹é…ä»»ä½•æ”»å‡»æ¨¡å¼

2. **Shell_MEV_0xa898_exp** (Robot1)
   - è¯†åˆ«åˆ°1ä¸ªå‡½æ•°è°ƒç”¨
   - åŸå› : å‡½æ•°åæœªåŒ¹é…ä»»ä½•æ”»å‡»æ¨¡å¼

3. **Gamma_exp** (Uniproxy)
   - è¯†åˆ«åˆ°0ä¸ªå‡½æ•°è°ƒç”¨
   - åŸå› : åˆçº¦åè¯†åˆ«æˆåŠŸ,ä½†ä»£ç ä¸­æœªæ‰¾åˆ°å¯¹è¯¥åˆçº¦çš„å‡½æ•°è°ƒç”¨

4. **XSIJ_exp** (PancakePair)
   - è¯†åˆ«åˆ°0ä¸ªå‡½æ•°è°ƒç”¨
   - åŸå› : åˆçº¦åè¯†åˆ«æˆåŠŸ,ä½†ä»£ç ä¸­æœªæ‰¾åˆ°å¯¹è¯¥åˆçº¦çš„å‡½æ•°è°ƒç”¨

5. **SocketGateway_exp** (_gateway)
   - è¯†åˆ«åˆ°0ä¸ªå‡½æ•°è°ƒç”¨
   - åŸå› : åˆçº¦åä¸º"_gateway",å¯èƒ½å‡½æ•°è°ƒç”¨ä½¿ç”¨äº†ä¸åŒçš„å˜é‡å

### ä»æœªå®Œå…¨è¯†åˆ«çš„åè®®

ä»…å‰©2ä¸ªåè®®å­˜åœ¨é—®é¢˜:

1. **BarleyFinance_exp_local** (None)
   - åŸå› : æµ‹è¯•å‰¯æœ¬,å¯èƒ½æ²¡æœ‰æ ‡å‡†æ³¨é‡Šæ ¼å¼
   - å½±å“: ä¸å½±å“ä¸»è¦åŠŸèƒ½(BarleyFinance_expæ­£å¸¸)

2. **WiseLending02_exp** (Unknown)
   - åœ°å€å·²è¯†åˆ«: 0x37e49bf3749513a02fa535f0cbc383796e8107e4
   - åŸå› : 4ç§åç§°æ¨æ–­ç­–ç•¥éƒ½æœªåŒ¹é…æˆåŠŸ
   - å»ºè®®: éœ€è¦æ£€æŸ¥æºæ–‡ä»¶çš„å…·ä½“å®šä¹‰æ–¹å¼

## ğŸ¨ å®ç°äº®ç‚¹

### 1. é²æ£’çš„æ¨¡å¼åŒ¹é…

```python
# æ”¯æŒå¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
match = re.search(pattern, self.script_content, re.IGNORECASE)

# æ”¯æŒå¯é€‰çš„ç©ºæ ¼
r'//\s*Vuln(?:erable)?\s+Contract'

# æ”¯æŒå¤šç§URLæ ¼å¼
r'https?://[^/]+/address/(0x[a-fA-F0-9]{40})'
```

### 2. å¤šå±‚å›é€€ç­–ç•¥

```python
# æŒ‰ä¼˜å…ˆçº§å°è¯•5ç§æ³¨é‡Šæ¨¡å¼
for pattern in patterns:
    match = re.search(pattern, ...)
    if match:
        return result

# å¦‚æœæ³¨é‡Šéƒ½å¤±è´¥,å°è¯•ä»ä»£ç å®šä¹‰æ¨æ–­
interface_pattern = r'I(\w+)\s+\w+\s*=\s*I\w+\((0x[a-fA-F0-9]{40})\)'
```

### 3. æ™ºèƒ½åç§°é¦–å­—æ¯å¤§å†™

```python
# ä»å°å†™å˜é‡åè½¬æ¢ä¸ºåˆçº¦å
# uniproxy -> Uniproxy
# robot1 -> Robot1
return var_name[0].upper() + var_name[1:] if var_name else "Unknown"
```

## ğŸ“ˆ æ€§èƒ½å½±å“

- **è¿è¡Œæ—¶é—´**: æ— æ˜¾è‘—å˜åŒ–(å¢åŠ çš„æ­£åˆ™åŒ¹é…å¼€é”€<1%)
- **æˆåŠŸç‡æå‡**: åˆçº¦è¯†åˆ«ç‡ä»52.6%æå‡åˆ°89.5% (+70%)
- **ä»£ç é‡**: +80è¡Œ(ä»109è¡Œå¢åŠ åˆ°189è¡Œ)
- **ç»´æŠ¤æ€§**: é€šè¿‡æ¨¡å¼æ•°ç»„æå‡å¯æ‰©å±•æ€§

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–

```python
# ä¼˜åŒ–å‰ (å•ä¸€æ¨¡å¼,ä¸¥æ ¼åŒ¹é…)
r'//\s*Vuln(?:erable)?\s+Contract\s*:\s*https?://[^/]+/address/(0x[a-fA-F0-9]{40})'

# ä¼˜åŒ–å (å¤šæ¨¡å¼,å®½æ¾åŒ¹é…)
patterns = [
    r'//\s*Vuln(?:erable)?\s+Contract\s*:',  # æ ‡å‡†
    r'-\s*Vuln(?:erable)?\s+Contract\s*:',   # Markdown
    r'//\s*Victim\s+Contract\s*:',          # å¤‡ç”¨å…³é”®è¯
    r'//\s*Vuln(?:erable)?\s*:',            # å®½æ¾
]
```

### åç§°æ¨æ–­ç­–ç•¥æƒé‡

| ç­–ç•¥ | ä¼˜å…ˆçº§ | å¯é æ€§ | é€‚ç”¨åœºæ™¯ |
|------|--------|--------|---------|
| ç­–ç•¥1: æ¥å£å®šä¹‰ | æœ€é«˜ | â­â­â­â­â­ | 90%çš„åè®® |
| ç­–ç•¥2: addresså¸¸é‡ | é«˜ | â­â­â­â­ | Gamma, LQDX_alert |
| ç­–ç•¥3: æ¥å£ç±»å‹å£°æ˜ | ä¸­ | â­â­â­ | å°‘æ•°åè®® |
| ç­–ç•¥4: å‡½æ•°è°ƒç”¨æ¨æ–­ | ä½ | â­â­ | Shell_MEV |

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### ä¼˜å…ˆçº§1: å¤„ç†WiseLending02 (é«˜)

```python
# æ£€æŸ¥ç‰¹æ®Šæƒ…å†µ
# å¯èƒ½æ˜¯Vmæ¥å£ä½†åç§°æ¨æ–­å¤±è´¥
# éœ€è¦æŸ¥çœ‹æºæ–‡ä»¶æ‰¾å‡ºå…·ä½“å®šä¹‰æ–¹å¼
```

### ä¼˜å…ˆçº§2: å¤„ç†å˜é‡åä¸ä¸€è‡´ (ä¸­)

```python
# SocketGatewayçš„é—®é¢˜:
# æ³¨é‡Šä¸­å®šä¹‰ _gateway
# ä½†å‡½æ•°è°ƒç”¨å¯èƒ½ä½¿ç”¨ gateway æˆ–å…¶ä»–å˜é‡å

# è§£å†³æ–¹æ¡ˆ: å°è¯•å¤šç§å˜é‡åå˜ä½“
def _try_variable_variants(self, contract_name):
    variants = [
        contract_name,
        '_' + contract_name,
        contract_name.lower(),
        # ...
    ]
```

### ä¼˜å…ˆçº§3: æ”¯æŒæ›´å¤šæ³¨é‡Šæ ¼å¼ (ä½)

```python
# æ·»åŠ æ›´å¤šæ¨¡å¼:
# /// @vulnerable 0x...
# /* Vulnerable: 0x... */
# @notice Attacked contract at 0x...
```

## ğŸ“ ç»“è®º

V3ç‰ˆæœ¬çš„åˆçº¦è¯†åˆ«å¢å¼ºå–å¾—äº†æ˜¾è‘—æˆæ•ˆ:

1. âœ… **ä¸»è¦ç›®æ ‡è¾¾æˆ**: åˆçº¦è¯†åˆ«ç‡ä»52.6%æå‡åˆ°89.5% (+70%)
2. âœ… **100%åœ°å€è¯†åˆ«**: æ‰€æœ‰åè®®éƒ½èƒ½è¯†åˆ«åˆ°åˆçº¦åœ°å€
3. âœ… **æ–°å¢1ä¸ªçº¦æŸ**: DAO_SoulMate_expç”Ÿæˆäº†drain_attackçº¦æŸ
4. âœ… **ä»£ç è´¨é‡æå‡**: å¤šæ¨¡å¼åŒ¹é…æé«˜é²æ£’æ€§å’Œå¯ç»´æŠ¤æ€§
5. âš ï¸ **æ”¹è¿›ç©ºé—´**: ä»æœ‰2ä¸ªåè®®éœ€è¦ç‰¹æ®Šå¤„ç†

**æ•´ä½“è¯„ä»·**: V3ç‰ˆæœ¬æˆåŠŸå°†åˆçº¦è¯†åˆ«ç‡æå‡åˆ°æ¥è¿‘90%,ä¸ºåç»­çš„å‡½æ•°è°ƒç”¨è¯†åˆ«å’Œçº¦æŸç”Ÿæˆå¥ å®šäº†åšå®åŸºç¡€ã€‚

---

**ç‰ˆæœ¬**: V3  
**ä¼˜åŒ–å†…å®¹**: åˆçº¦è¯†åˆ«ç‡æå‡  
**æµ‹è¯•æ—¥æœŸ**: 2025-11-21  
**æµ‹è¯•åè®®æ•°**: 19  
**åˆçº¦è¯†åˆ«æˆåŠŸç‡**: 89.5% (17/19)  
**ç”Ÿæˆçº¦æŸæˆåŠŸç‡**: 36.8% (7/19)
